let JavaArray=java.lang.reflect.Array,StringBuilder=java.lang.StringBuilder,KeyEvent=android.view.KeyEvent,Linkify=android.text.util.Linkify,ColorStateList=android.content.res.ColorStateList,DialogAction=com.afollestad.materialdialogs.DialogAction,Pref=org.autojs.autojs.Pref,File=java.io.File,FileInputStream=java.io.FileInputStream,FileOutputStream=java.io.FileOutputStream,InputStreamReader=java.io.InputStreamReader,BufferedReader=java.io.BufferedReader,BufferedInputStream=java.io.BufferedInputStream,BufferedOutputStream=java.io.BufferedOutputStream,CheckedOutputStream=java.util.zip.CheckedOutputStream,ZipOutputStream=java.util.zip.ZipOutputStream,ZipEntry=java.util.zip.ZipEntry,ZipFile=java.util.zip.ZipFile,CRC32=java.util.zip.CRC32,URL=java.net.URL,Request=Packages.okhttp3.Request,HttpURLConnection=java.net.HttpURLConnection;!function(){"use strict";let d=(o.bytes=function(e,t,r){return function(e,t,r,n){t=void 0===t?{}:{init_unit:t};return o(e,Object.assign(t,n,r))}(e,t,r,{step:1024,potential_step:1e3,units:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]})},o.date=function(e,t){var r=e=>("0"+e).slice(-2);let n=function(t){if(t instanceof Date)return t;if("number"==typeof t)return new Date(t);if("string"!=typeof t)return new Date;{t.match(/^\d+$/)&&(8===t.length?t=t.replace(/\d{2}/g,"$&%").split("%").slice(0,-1).map((e,t)=>1<t?"/"+e:e).join(""):12===t.length?t=t.replace(/\d{2}/g,"$&%").split("%").slice(0,-1).map((e,t)=>0===t?(new Date).getFullYear().toString().slice(0,2)+e:t<3?"/"+e:3===t?" "+e:t<6?":"+e:e).join(""):14===t.length&&(t=t.replace(/\d{2}/g,"$&%").split("%").slice(0,-1).map((e,t)=>1<t&&t<4?"/"+e:4===t?" "+e:4<t&&t<7?":"+e:e).join("")));let e=new Date(t);if("Invalid Date"===e.toString())throw Error("Invalid Date");return e}}(e||new Date),o=n.getFullYear();var i=o.toString().slice(-2),s=n.getMonth()+1,a=r(s),l=n.getDate(),c=r(l),u=n.getHours(),f=r(u),p=n.getMinutes(),d=r(p),e=n.getSeconds(),r=r(e),g={yyyy:o,yy:i,MM:a,M:s,dd:c,d:l,hh:f,h:u,mm:d,m:p,ss:r,s:e};return function(e){let t=e.toString(),r="";for(;t.length;){let e=4;for(;e;){var n=t.slice(0,e);if(n in g){r+=g[n],t=t.slice(e);break}--e}e||(r+=t[0],t=t.slice(1))}return r}(t||"yyyy/MM/dd hh:mm:ss")},o);function o(e,t){let{step:r,potential_step:n,units:o,init_unit:i,space:s,fixed:a}=t||{},l="string"==typeof e?Number(e.split(/,\s*/).join("")):Number(e),c=[];o.forEach(e=>{"string"==typeof e&&e.match(/\w+\|\w+/)?e.split("|").reverse().forEach((e,t)=>{t?c.push(1,e):c.push(e)}):c.push(e)});let u={};u[c[0]]=[1,1];let f=1,p;for(let t=1,e=c.length;t<e;t+=1){p=n?f:0;let e=c[t];var d;"number"==typeof e?(p=f*(n||e),f*=e,e=c[++t]):Array.isArray(e)?(d=e.sort((e,t)=>e<t?1:-1),p=f*d[1],f*=d[0],e=c[++t]):(p=f*(n||r),f*=r),e.split("|").forEach(e=>u[e]=p?[f,p]:[f,f])}e=i||c[0],~c.indexOf(e)&&(l*=u[e][0]);let g="";return Object.keys(u).reverse().some(t=>{var[r,e]=u[t];if(l>=e){let e=Number((l/r).toFixed(12));"number"==typeof a?e=~a?e.toFixed(a):e:1e3*e>>0!=1e3*e&&(e=e.toFixed(2));r=s?!0===s?" ":s:"";return g=Number(e)+r+t}}),g}let n={_project_structure:[{name:"/documents"},{name:"/modules",necessary:!0},{name:"/tools"},{name:"ant-forest-launcher.js",necessary:!0},{name:"ant-forest-settings.js",necessary:!0},{name:".gitignore"},{name:"jsconfig.json"},{name:"project.json",necessary:!0},{name:"LICENSE"},{name:"README.md"}],_project_step:{download:"下载数据包",decompress:"解压缩",backup:"备份本地项目",files_check:"检查文件",files_update:"项目文件替换",files_ready:"项目文件就绪",finish_deploy:"清理并完成部署",finish_restore:"清理并完成项目恢复"},deployProject:function(e,t,r){let i=this;var n=r||{},o=t||{};let s=o.onDeployStart||o.onStart||(e=>e),a=o.onDeploySuccess||o.onSuccess||(e=>e),l=o.onDeployFailure||o.onFailure||console.error;if(null==e)throw Error("A version for appx.deployProject() must be defined");if("string"==typeof e&&!(e=function(t){if(t.match(/^(newest|latest)$/))return i.getProjectNewestRelease({show_progress_dialog:!0});if(t.match(/^(newest|latest)_cared$/))return i.getProjectNewestReleaseCared({show_progress_dialog:!0});let r=null;return i.getProjectReleases({per_page:100,show_progress_dialog:!0}).some(e=>(r=e).version_name===t),r}(e))){if(global._$_get_proj_releases_interrupted)return void delete global._$_get_proj_releases_interrupted;throw Error("Cannot parse version tag for appx.deployProject()")}if("object"!=typeof e)throw Error("Cannot parse version for appx.deployProject()");let c=e.zipball_url;var r=c.slice(c.lastIndexOf("/")+1)+".zip",u=(t=File.separator,o=files.getSdcardPath()+"/.local/bak/ant-forest",files.exists(o)||files.createWithDirs(o+t),new File(o).getAbsolutePath())+File.separator+r;let f=-1;g.getContentLength(c,function(e){p.setStepDesc(1,"  [ "+d.bytes(f=e,"B",{fixed:1,space:!0})+" ]",!0)},{timeout:15e3,concurrence:15});r=n.is_hide_title_version?"":" "+e.version_name,e=this._project_step;let p=m.buildFlow({title:"正在部署项目"+r,success_title:n.success_title||"部署完成",on_interrupt_btn_text:n.on_interrupt_btn_text||"B",show_min_max:!0,onStart:(e,t)=>{s(),m.setProgressColorTheme(t,"download")},onSuccess:(e,t)=>a(e,t),onFailure:(e,t)=>{l(e,t),t.setFailureData(e)},steps:[{desc:e.download,action:(e,n)=>new Promise((t,r)=>{g.okhttp3Request(c,u,{onStart:function(){let e=f/1024;var t=e<0?"":"0KB/"+e.toFixed(1)+"KB";m.setProgressNumberFormat(n,t)},onDownloadProgress:function(e){e.total=Math.max(e.total,f);var t=e.total/1024,r=e.processed/1024;m.setProgressNumberFormat(n,"%.1fKB/%.1fKB",[r,t]),n.setProgressData(e)},onDownloadSuccess:function(e){t(e),m.clearProgressNumberFormat(n)},onDownloadFailure:function(e){r(e)}},{is_async:!0})})},{desc:e.decompress,action:(o,t)=>new Promise((r,n)=>{h.unzip(o.downloaded_path,null,{onUnzipProgress:e=>t.setProgressData(e),onUnzipSuccess:function(e){let t=e.unzipped_path;i.isProjectLike(t)||(t+=File.separator+files.listDir(t)[0]),i.isProjectLike(t)||n("Cannot locate project path in unzipped files"),r(Object.assign(o,{unzipped_files_path:e.unzipped_path,unzipped_proj_path:t}))},onUnzipFailure:e=>n(e)},{to_archive_name_folder:!0,is_delete_source:!0})})},{desc:e.backup,action:(n,o)=>new Promise((t,r)=>{if(!i.getProjectLocalPath()||!i.getProjectLocalVerName())return o.setStepDesc(3,"  [ 跳过 ]",!0),t(n);i.backupProject({onBackupProgress:e=>o.setProgressData(e),onBackupSuccess:e=>t(Object.assign(n,{backup:e})),onBackupFailure:e=>r(e)},{remark:"版本升级前的自动备份",is_save_storage:!0})})},{desc:e.files_update,action:(n,o)=>new Promise((e,t)=>{var r=i.getProjectLocalPath(!0);h.copy(n.unzipped_proj_path,r,{is_unbundled:!0},{onCopyProgress:e=>o.setProgressData(e),onCopySuccess:()=>e(Object.assign(n,{tar_proj_path:r})),onCopyFailure:e=>t(e)})})},{desc:e.finish_deploy,action:(r,n)=>new Promise((e,t)=>{h.deleteByList(r.unzipped_files_path,{is_async:!0},{onDeleteProgress:e=>n.setProgressData(e),onDeleteSuccess:()=>e({target_path:r.tar_proj_path}),onDeleteFailure:e=>t(e)})})}]}).act()},getProjectLocal:function(){var e=this.getProjectLocalPath();if(!e)throw Error("Cannot locate project path for appx.getProjectLocal()");var t=File.separator,r="project.json",n=e+t+r,o="ant-forest-launcher.js",i=e+t+o,s={version_name:"",version_code:-1,main:i,path:e};if(files.exists(n))try{var a=JSON.parse(h.read(n));return Object.assign(s,{version_name:"v"+a.versionName,version_code:Number(a.versionCode),main:a.main})}catch(e){console.warn(e.message),console.warn(e.stack)}if(files.exists(i))try{return Object.assign(s,{version_name:"v"+h.read(i).match(/version (\d+\.?)+( ?(Alpha|Beta)(\d+)?)?/)[0].slice(8)})}catch(e){console.warn(e.message),console.warn(e.stack)}return console.warn("Both "+r+" and "+o+" do not exist"),s},getProjectReleases:function(c,e){if("function"!=typeof e)return t();function t(){let e=[];var t=c||{};let r=null;delete global._$_get_proj_releases_interrupted,t.show_progress_dialog&&m.setProgressColorTheme(r=m.builds([null,"正在获取版本信息...",0,0,"I",1],{progress:{max:-1,showMinMax:!1,horizontal:!0},disable_back:!0}).on("positive",e=>{e.dismiss(),global._$_get_proj_releases_interrupted=!0}).show(),"indeterminate");var n=t.max_items||1/0;let o=1;var i=t.per_page||30,s=t.min_version_name||"v0.0.0";let a=3;for(;a--;)try{var l=http.get("https://api.github.com/repos/SuperMonster003/Ant-Forest/releases?per_page="+i+"&page="+o++).body.json().filter(e=>e.tag_name>=s);if(global._$_get_proj_releases_interrupted)return[];if(e=e.concat(l),l.length<i||e.length>=n)break}catch(e){sleep(120+240*Math.random())}return a<0?(r&&(r.dismiss(),m.builds(["失败","版本信息获取失败",0,0,"X",1]).on("positive",e=>e.dismiss()).show()),[]):(e.splice(n),r&&(r.dismiss(),r=null),t.no_extend?e:e.map(function(n){return n.version_name=n.tag_name,n.brief_info_str=[{key:"name",desc:"标题"},{key:"tag_name",desc:"标签"},{key:"published_at",desc:"发布",cvt:d.date},{key:"body",desc:"内容描述"}].map(e=>{var t=e.key;let r=n[t];if(r)return"body"===t&&(r="\n"+r),"function"==typeof e.cvt&&(r=e.cvt.call(null,r)),e.desc+": "+r}).filter(e=>!!e).join("\n\n"),n}))}y.start(function(){e(t())})},getProjectChangelog:function(e,t,r){let n=this,s=Math.trunc(Number(e.toString().match(/\d+/)[0])),a=t||{};r=r||{};let l=r.onStart||(e=>e),c=r.onSuccess||(e=>e),u=r.onFailure||console.error,f=null;if(!a.is_show_dialog)return p();let o=null,i=e=>e;function p(){l();let e=function(){let a=5;for(;a--;)try{return function(e){let t=new URL(e),r=t.openConnection();r.setRequestMethod("GET"),r.setConnectTimeout(15e3),r.setReadTimeout(15e3),r.connect();e=r.getResponseCode();if(e!==HttpURLConnection.HTTP_OK){a||u("请求失败: "+e);try{r.disconnect()}catch(e){}return null}let n=r.getInputStream(),o=new BufferedReader(new InputStreamReader(n)),i=new StringBuilder,s=null;for(;null!==(s=o.readLine());)i.append(s).append("\r\n");return[r,o,n].forEach(e=>{try{e.close()}catch(e){}}),i.toString()}("https://github.com/SuperMonster003/Ant-Forest/blob/master/documents/CHANGELOG-"+s+".md").match(/版本历史[^]+article/)[0].replace(/<path .+?\/path>/g,"").replace(/<a .+?(<code>((issue |pr )?#\d+)<\/code>)?<\/a>/g,(e,t,r)=>r?"_[`"+r+"`]_":"").replace(/<svg .+?\/svg>/g,"").replace(/<link>.+/g,"").replace(/<h1>/g,"# ").replace(/<h6>/g,"###### ").replace(/<\/?(li|ul|del|em|h\d)>/g,"").replace(/<code>/g,"* `").replace(/<\/code>/g,"`").replace(/\s*<\/articl.*/,"")}catch(e){}return null}();if(!e){var t="获取历史更新信息失败";return f?f.setContent(t):u(t),a.is_joint?"":[]}var t=/# v\d+\.\d+\.\d+.*/g,r=new RegExp(/^(\s*\n\s*)+/.source+"|"+/(# *){3,}/.source+"|"+/ +(?=\s+)/.source+"|"+/.*~~.*/.source+"|"+/.*`灵感`.*/.source+"|"+/\(http.+?\)/.source+"|"+/\[\/\/]:.+\(\n*.+?\n*\)/.source+"|"+/\s*<br>/.source,"g");let n=e.match(t),o=e.split(t),i=n.map((e,t)=>({ver:"v"+e.split("v")[1],log:o[t+1].replace(/ ?_\[`(issue |pr )?#(\d+)`](\(http.+?\))?_ ?/g,"[$2]").replace(r,"").replace(/(\[\d+])+/g,e=>" "+e.split(/\[]/).join(",").replace(/\d+/g,"#$&")).replace(/(\s*\n\s*){2,}/g,"\n")}));if(c(i),!f&&!a.is_joint)return i;t=i.map(e=>e.ver+"\n"+e.log).join("\n").slice(0,-1);return f&&f.setContent(t),a.is_joint?t:void 0}!a.no_earlier&&1<s&&(o="更早期的历史",i=function(){m.builds(["选择一个历史版本记录","",0,0,"B",1],{items:(()=>{let t=[];for(let e=1;e<s;e+=1)t.push("v"+e+".x");return t})()}).on("positive",m.dismiss).on("item_select",e=>{n.getProjectChangelog(e+1,{is_show_dialog:!0,no_earlier:!0})}).show()}),f=m.builds(["历史更新","处理中...",[o,"hint"]," ","B",1]).on("neutral",i).on("positive",m.dismiss).show(),y.start(p)},isProjectLike:function(e,t){var r=files.path(e);if(!files.exists(r)){if(t)throw Error('Passed "dir" is not exist');return!1}if(!files.isDir(r)){if(t)throw Error('Passed "dir" is not a directory');return!1}let n=files.listDir(r=new File(r).getAbsolutePath());return this._project_structure.filter(e=>e.necessary).map(e=>"/"===e.name[0]?{name:e.name.slice(1),is_dir:!0}:{name:e.name}).every(e=>{if(~n.indexOf(e.name)){var t=e.is_dir,e=files.isDir(r+File.separator+e.name);return t&&e||!t&&!e}})},getProjectLocalPath:function(e){let t=files.cwd();if(this.isProjectLike(t))return t;if(t=new File(t).getParent(),this.isProjectLike(t))return t;var r=h.getScriptDirPath(),n=File.separator,r=r+n+"Ant-Forest-003";return files.isDir(r)?r:e?(files.createWithDirs(r+n),r):""},backupProject:function(e,t){let o=this,i=File.separator,s=e||{},a=t||{},l=Date.now(),c=o.getProjectLocalVerName();var r=o.getVerHex(c);let u=(e=File.separator,t=files.getSdcardPath()+"/.local/bak/ant-forest",files.exists(t)||files.createWithDirs(t+e),new File(t).getAbsolutePath());r=d.date(l,"yyMMddhhmmss")+"-"+r+".zip";let f=u+i+r;return a.is_show_dialog?m.buildProgress({show_min_max:!0,title:"正在备份",content:"此过程可能需要一些时间",success_title:"备份完成",onStart:(e,t)=>m.setProgressColorTheme(t,"backup"),action:function(e,n){return p({onProgress:function(e){var t=e.processed/1024,r=e.total/1024;m.setProgressNumberFormat(n,"%.1fKB/%.1fKB",[t,r]),n.setProgressData(e)},onSuccess:function(e){m.setContentText(n,"版本: "+e.version_name+"\n路径: "+e.path+"\n备注: "+e.remark)}})}}).act():p();function p(e){let n=e||{};return h.zip(function(){var e=u+i+"."+l+i;files.createWithDirs(e);let t=function(){let e=a.source_path;e&&"cwd"!==e&&"current"!==e||(e=files.cwd());if(!files.isDir(e))throw Error("source_path for appx.backupProject must be a directory");if(o.isProjectLike(e))return e;if(e=new File(e).getParent(),o.isProjectLike(e))return e;var t=h.getScriptDirPath(),r=File.separator;if(e=t+r+"Ant-Forest-003",o.isProjectLike(e))return e;throw Error("Unable to locate Ant-Forest project folder")}(),r=o._project_structure.map(e=>e.name.replace(/^\//,""));return h.copy(t,e,{is_unbundled:!0,filter:function(e){return!!~r.indexOf(e)}}),e}(),f,{onZipStart:function(){"function"==typeof n.onStart&&n.onStart();let e=s.onBackupStart||s.onStart;"function"==typeof e&&e.call(s)},onZipProgress:function(e){"function"==typeof n.onProgress&&n.onProgress(e);let t=s.onBackupProgress||s.onProgress;"function"==typeof t&&t.call(s,e)},onZipSuccess:function(){var r={path:f,timestamp:l,version_name:c,remark:a.remark||"手动备份"};"function"==typeof n.onSuccess&&n.onSuccess(r);let e=s.onBackupSuccess||s.onSuccess;if("function"==typeof e&&e.call(s,r),a.is_save_storage){let e=_.create("af_bak"),t=e.get("project",[]);e.put("project",t.concat(r))}},onZipFailure:function(e){"function"==typeof n.onFailure&&n.onFailure(e);let t=s.onBackupFailure||s.onFailure;"function"==typeof t&&t.call(s,e)}},{is_exclude_root_folder:!0,is_delete_source:!0})}},getProjectLocalVerName:function(){return this.getProjectLocal().version_name},getVerHex:function(e,t){if(!(e="object"==typeof e?e.version_name:e))throw Error('A "version" must be defined for appx.getVerHex()');var r=t||{},a=e=>("00"+Number(e||0).toString(16)).slice(-2),t=e.toString().trim().replace(/^[a-z\s]*(\d+)(?:\.(\d+)(?:\.(\d+)(?:-\d+)?\s*(a(?:lpha)?|b(?:eta)?)?\s*(\d*))?)?$/i,(e,t,r,n,o,i)=>{n=[t,r,n].map(e=>a(e)).reduce((e,t)=>e+t),i=i?Number(i):1;let s=255;if(o)if(o.match(/a(lpha)?/i)){if(128<i)throw Error("Alpha version code cannot be greater than 128");s=0}else if(o.match(/b(eta)?/i)){if(127<=i)throw Error("Alpha version code must be smaller than 127");s=128}return n+a(Math.min(s+i,255))}),e="0x"+t;return"number"===r.type?Number(e):"string_with_prefix"===r.type?e:t},getProjectNewestRelease:function(e,t){let r=this;if("function"!=typeof t)return n();function n(){return r.getProjectReleases(Object.assign(e||{},{max_items:1,per_page:1}))[0]}y.start(function(){t(n())})}},g={getContentLength:function(r,n,e){if("string"!=typeof r)throw Error("url for httpx.getContentLength() is required");if("function"!=typeof n)throw Error("callback for httpx.getContentLength() is required");var e=e||{},o=e.timeout||1e4,i=Date.now()+o;let s=threads.atomic(-1);var t=e.concurrence||12;for(let e=0;e<t;e+=1)!function(e){let t=y.start(function(){try{let e=new URL(r).openConnection();e.setRequestProperty("Accept-Encoding","identity"),e.setConnectTimeout(o);var t=e.getContentLengthLong();e.disconnect(),~t&&s.compareAndSet(-1,t)&&n(s.get())}catch(e){}});y.start(function(){for(;;){if(0<s.get())return t.interrupt();if(Date.now()>=i)return e(-1),t.interrupt();sleep(120)}})}()},okhttp3Request:function(a,e,t,r){let l,c,u,f;var p=files.path(e);let n=t||{};var d=r||{};let g=n.onStart||(e=>e),h=n.onResponse||(e=>e),m=n.onDownloadProgress||(e=>e),_=n.onDownloadSuccess||(e=>e);var v=e=>{if("function"!=typeof n.onDownloadFailure)throw Error(e);n.onDownloadFailure(e)};if(!a)return v("url for httpx.okhttp3Request() is required");function o(){try{g();let t=new Request.Builder;Object.keys(d.headers||{}).forEach(e=>{t.addHeader(e,d.headers[e])});let e=(new OkHttpClient).newCall(t.url(a).get().build()).execute();h(e);var o=JavaArray.newInstance(java.lang.Byte.TYPE,4096);let r,n=0;var i=e.code();200!==i&&v(i+" "+e.message()),l=e.body().byteStream(),u=new BufferedInputStream(l),c=new FileOutputStream(new File(p)),f=new BufferedOutputStream(c);for(var s=e.body().contentLength();~(r=u.read(o,0,4096));)global._$_dialog_flow_interrupted&&(w(),v("用户终止")),c.write(o,0,r),n+=r,m({processed:n,total:s});w(),_({downloaded_path:p})}catch(e){v("请求失败:\n"+e)}}function w(){[f,c,u,l].forEach(e=>{try{e&&e.close()}catch(e){}}),global._$_dialog_flow_interrupted=!1}void 0===d.is_async||d.is_async?y.start(o):o()}},h={_files$copy:function(e,t,r){var a=files.path(e),n=files.path(t),r=r||{};let o=r.onCopyStart||r.onStart||(e=>e),l=r.onCopyProgress||r.onProgress||(e=>e),c=r.onCopySuccess||r.onSuccess||(e=>e),u=r.onCopyFailure||r.onFailure||console.error;try{return function(e,t){o(),files.createWithDirs(t);var r=new File(t);try{var n=new FileOutputStream(r);return function(e,t,r){let n=util.java.array("byte",8192),o=new File(a).length(),i=0;try{for(;0<e.available();){var s=e.read(n);0<s&&(t.write(n,0,s),l({processed:i+=s,total:o}))}r&&(e.close(),t.close()),c()}catch(e){u(e)}}(e,n,!0),!0}catch(e){return u(e),!1}}(new FileInputStream(a),n)}catch(e){return u(e),!1}},getScriptDirPath:function(){return("function"==typeof Pref.getScriptDirPath?Pref:com.stardust.autojs.core.pref.Pref.INSTANCE).getScriptDirPath()},unzip:function(e,t,r,n){let i,s,a;function l(){global._$_dialog_flow_interrupted=!1,[s,i,a].forEach(e=>{try{e&&e.close()}catch(e){}})}var c=r||{},u=e=>{let t=c.onUnzipFailure||c.onFailure;return("function"==typeof t?t:toastLog)(e),!1};let o=c.onUnzipStart||c.onStart;"function"==typeof o&&o();var f=File.separator,p=n||{};let d=files.path(e);if(files.exists(d)||(d+=".zip"),!files.exists(d))throw Error("解压缩源不存在");let g=new File(d);var h=g.length();let m=g.getName();e=m.slice(0,m.lastIndexOf("."));let _=files.path(t);_&&files.exists(_)||(_=d.slice(0,d.lastIndexOf(f))),p.to_archive_name_folder&&(_+=f+e),files.createWithDirs(_+f);try{let n=0;var v=util.java.array("byte",1024);let o=new ZipFile(g),e=o.entries();for(;e.hasMoreElements();){let t=e.nextElement();var w=t.getCompressedSize(),y=t.getName(),y=files.path(_+f+y);files.createWithDirs(y);let r=new File(y);if(!r.isDirectory()){var b;for(i=new FileOutputStream(r),s=new BufferedOutputStream(i),a=new BufferedInputStream(o.getInputStream(t));~(b=a.read(v,0,1024));){if(global._$_dialog_flow_interrupted)return l(),u("用户终止");i.write(v,0,b)}let e=c.onUnzipProgress||c.onProgress;"function"==typeof e&&e({processed:n+=w,total:h})}}l();let t=c.onUnzipSuccess||c.onSuccess;return"function"==typeof t&&t({unzipped_path:_}),p.is_delete_source&&this.removeWithDirs(d,{is_async:!0}),!0}catch(e){return u("解压失败:\n"+e)}},removeWithDirs:function(n,e,t){var r=e||{},t=t||{};let o=t.onRemoveStart||t.onStart||(e=>e),i=t.onRemoveProgress||t.onProgress||(e=>e),s=t.onRemoveSuccess||t.onSuccess||(e=>e),a=t.onRemoveFailure||t.onFailure||console.error,l=0,c=1;try{return r.is_async?y.start(u):u()}catch(e){a(e)}function u(){let t=!0;if(o(),files.isFile(n))t=f(n);else{if(!files.isDir(n))throw Error("Cannot parse path for filesx.removeWithDirs()");{let e=files.listDir(n);var r=File.separator;c=e.length,e.forEach(e=>{t=f(n+r+e)&&t}),files.remove(n)}}return t&&s(),t||a("An error has occurred in files.removeWithDirs()"),t}function f(e){e=files.isDir(e)?files.removeDir(e):!!files.isFile(e)&&files.remove(e);return i({progress:l+=1,total:c}),e}},deleteByList:function(o,e,t){let i=this;e=e||{},t=t||{};let s=t.onDeleteStart||t.onStart||(e=>e),a=t.onDeleteProgress||t.onProgress||(e=>e),l=t.onDeleteSuccess||t.onSuccess||(e=>e),c=t.onDeleteFailure||t.onFailure||console.error;if(e.is_async)return r();function r(){s();let t=!0,e=i.listAllFiles(o).reverse(),r=0;var n=e.length;return e.forEach(e=>{t=e.delete()&&t,a({processed:r+=1,total:n})}),t&&l(),t||c("An error has occurred in files.deleteByList()"),t}y.start(r)},listAllFiles:function(e){let r=[];return function e(t){t.isFile()?r.push(t):t.isDirectory()&&(r.push(t),t.listFiles().forEach(e))}(e="string"==typeof e?new File(files.path(e)):e),r},zip:function(e,t,r,n){let i,s,o,a,l,c=function(){global._$_dialog_flow_interrupted=!1,[l,a,o,s,i].forEach(e=>{try{e&&e.close()}catch(e){}})};let u=r||{},f=n||{},p=e=>{let t=u.onZipFailure||u.onFailure;return("function"==typeof t?t:toastLog)(e),!1},d=u.onZipStart||u.onStart;"function"==typeof d&&d();var g,h=files.path(e);if(!files.exists(h))throw Error("无效的压缩源");let m=new File(h);h=m.getAbsolutePath();let _=t?files.path(t):h+".zip",v=new File(_);_=v.getAbsolutePath(),"zip"!==files.getExtension(_)&&(v=new File(_+=".zip")),files.exists(_)&&files.remove(_);let w=0,y=this.getDirSize(h);try{o=new FileOutputStream(v),a=new CheckedOutputStream(o,new CRC32),l=new ZipOutputStream(a),g=m,f.is_exclude_root_folder&&g.isDirectory()?g.listFiles().filter(e=>e.getAbsolutePath()!==v.getAbsolutePath()).forEach(e=>b(e)):b(g),c();let e=u.onZipSuccess||u.onSuccess;return"function"==typeof e&&e({zipped_path:_}),f.is_delete_source&&this.removeWithDirs(h,{is_async:!0}),!0}catch(e){return p("压缩失败:\n"+e)}function b(r,e){var n=(e?e+File.separator:"")+r.getName();if(r.isFile()){let e;var o=util.java.array("byte",1024);for(l.putNextEntry(new ZipEntry(n)),i=new FileInputStream(r),s=new BufferedInputStream(i);~(e=s.read(o,0,1024));){if(global._$_dialog_flow_interrupted)return c(),p("用户终止");l.write(o,0,e)}l.closeEntry(),s.close(),i.close();let t=u.onZipProgress||u.onProgress;"function"==typeof t&&t({processed:w+=r.length(),total:y})}else r.listFiles().filter(e=>e.getAbsolutePath()!==v.getAbsolutePath()).forEach(e=>b(e,n))}},copy:function(e,t,r,n){n=n||{};let a=n.onCopyStart||n.onStart||(e=>e),l=n.onCopyProgress||n.onProgress||(e=>e),c=n.onCopySuccess||n.onSuccess||(e=>e),u=n.onCopyFailure||n.onFailure||console.error;e&&t||u("Source and target path must be both defined"),files.isDir(t)||u("Target path must be a directory");let f=this,p=File.separator,d=new File(files.path(e)).getAbsolutePath(),g=new File(files.path(t)).getAbsolutePath();r=r||{};let h=r.is_unbundled,m=r.filter||function(){return!0};if(!r.is_async)return o();function o(){"function"==typeof a&&a();let n=!0,o=0,i=1;if(files.isDir(d)){h||(g+=p+files.getName(d));let e=files.listDir(d,m);i=e.length,e.forEach(e=>s(d+p+e,g))}else s(d,g);return n&&c(),n||u("An error has occurred in files.copy()"),n;function s(t,e){var r=e+p+files.getName(t);files.isFile(t)?(f._files$copy(t,r)||(n=!1),l({processed:o+=1,total:i})):files.listDir(t).forEach(e=>{s(t+p+e,r)})}}y.start(o)},getDirSize:function(e){e=files.path(e);if(!files.exists(e))throw Error("path of filesx.getDirSize() is not exist");return files.isFile(e)?new File(e).length():new File(e).listFiles().reduce((e,t)=>e+(t.isDirectory()?this.getDirSize(t):t.length()),0)},read:function(e){let t=files.open(e,"r");e=t.read();return t.close(),e}};var l={toInt:function(t){let e;try{e="string"==typeof t?colors.parseColor(t):t}catch(e){throw console.error("Passed color: "+t),Error(e)}if("number"!=typeof e)throw TypeError("Unknown type of color for colorsx.toInt()");return e}};let y={start:function(e,t){try{return threads.start(e)}catch(e){var r=/(Script)?InterruptedEx|script exiting/;if(!e.message.match(r)&&!t)throw Error(e)}}},m={_colors:{wrap:function(e,t){if(t&&this[t])for(var r in this[t])if(this[t].hasOwnProperty(r)&&e===r){var n=this[t][r];return Array.isArray(n)?n[0]:n}return e},title:{default:"#212121",caution:"#880e4f",alert:["#c51162","#ffeffe"]},content:{default:"#757575",warn:"#ad1457",alert:["#283593","#e1f5fe"]},progress:{download:["#ff6f00","#ffecb3","#c43e00"],files:["#f9a825","#fff59d","#c17900"],backup:["#455a64","#eceff1","#1c313a"],restore:["#ab47bc","#f3e5f5","#790e8b"],indeterminate:["#00897b","#b2dfdb","#005b4f"],finish:["#00c853","#dcedc8","#009624"],success:["#00c853","#dcedc8","#009624"],error:["#1565c0","#bbdefb","#003c8f"],failure:["#1565c0","#bbdefb","#003c8f"]},button:{default_aj_4:"#01a9f3",default:"#03a9f4",caution:"#ff3d00",warn:"#f57c00",attraction:"#7b1fa2",hint:"#0da798",reset:"#a1887f",unavailable:"#bdbdbd",finish:"#009624",success:"#009624",error:"#003c8f",failure:"#003c8f"}},_text:{_btn:{F:"完成",B:"返回",Q:"放弃",X:"退出",I:"终止",K:"确定",S:"确认",C:"关闭",D:"删除",N:"继续",M:"确认修改",R:"使用默认值",T:"了解更多"},no_more_prompt:"不再提示",user_interrupted:"用户终止"},build:function(t){let r=this,n=Object.create(runtime.dialogs.newBuilder());return n.thread=threads.currentThread(),Object.keys(t).forEach(e=>function(t,r,n){let o={title:null,titleColor:{adapter:l.toInt},buttonRippleColor:{adapter:l.toInt},icon:null,content:null,contentColor:{adapter:l.toInt},contentLineSpacing:null,items:null,itemsColor:{adapter:l.toInt},positive:{method:"positiveText",adapter:i},positiveColor:{adapter:l.toInt},neutral:{method:"neutralText",adapter:i},neutralColor:{adapter:l.toInt},negative:{method:"negativeText",adapter:i},negativeColor:{adapter:l.toInt},cancelable:null,canceledOnTouchOutside:null,autoDismiss:null};if(o.hasOwnProperty(r)){let e=o[r]||{};void 0===e.method&&(e.method=r),e.adapter&&(n=e.adapter(n)),t[e.method].call(t,n)}}(n,e,t[e])),function(o,t){var e,r;if(void 0===t.inputHint&&void 0===t.inputPrefill||(e=i(t.inputHint),r=i(t.inputPrefill),o.input(e,r,function(e,t){return o.emit("input_change",o.dialog,t.toString())}).alwaysCallInputCallback()),void 0!==t.items){var n=t.itemsSelectMode;if(void 0===n||"select"===n)o.itemsCallback(function(e,t,r,n){o.emit("item_select",r,n.toString(),o.dialog)});else if("single"===n)o.itemsCallbackSingleChoice(void 0===t.itemsSelectedIndex?-1:t.itemsSelectedIndex,function(e,t,r,n){return o.emit("single_choice",r,n.toString(),o.dialog),!0});else{if("multi"!==n)throw new Error("Unknown itemsSelectMode "+n);o.itemsCallbackMultiChoice(void 0===t.itemsSelectedIndex?null:t.itemsSelectedIndex,function(e,t,r){return o.emit("multi_choice",s(t,(e,t)=>parseInt(e[t])),s(r,(e,t)=>e[t].toString()),o.dialog),!0})}}if(void 0!==t.progress&&(n=t.progress,o.progress(-1===n.max,n.max,!!n.showMinMax),o.progressIndeterminateStyle(!!n.horizontal)),void 0===t.checkBoxPrompt&&void 0===t.checkBoxChecked||o.checkBoxPrompt(i(t.checkBoxPrompt),!!t.checkBoxChecked,function(e,t){return o.getDialog().emit("check",t,o.getDialog())}),void 0!==t.customView){let e=t.customView;"xml"!=typeof e&&"string"!=typeof e||(e=ui.run(()=>ui.inflate(e)));t=t.wrapInScrollView;o.customView(e,void 0===t||t)}function i(e){return e||""}function s(t,r){let n=[];var o=t.length;for(let e=0;e<o;e++)n.push(r(t,e));return n}}(n,t),ui.run(n.buildDialog.bind(n));function i(e){return r._text._btn[e]||e}},builds:function(e,t){let[r,n,o,i,s,a,l]="string"==typeof e?[e]:e,c={autoDismiss:!a,canceledOnTouchOutside:!a,checkBoxPrompt:l?"string"==typeof l?l:this._text.no_more_prompt:void 0};[["title",r,this._colors.title],["content",n,this._colors.content],["neutral",o,this._colors.button,this._text._btn],["negative",i,this._colors.button,this._text._btn],["positive",s,this._colors.button,this._text._btn]].forEach(e=>function(e,t,r,n){var[o,t]=Array.isArray(t)?t:[t];o&&(c[e]=n&&n[o]||o);c[e+"Color"]=r[t]||t||r.default}.apply(null,e));e=t||{},t=this.build(Object.assign(c,e));return e.linkify&&this.linkify(t),e.disable_back&&this.disableBack(t,e.disable_back),t},getContentText:function(e){return e?e.getContentView().getText().toString():null},appendContentText:function(e,t){ui.run(()=>{e&&e.getContentView().setText(this.getContentText(e)+(t?t.toString():""))})},getDialogAction:function(e){try{switch(e){case"positive":return DialogAction.POSITIVE;case"negative":return DialogAction.NEGATIVE;case"neutral":return DialogAction.NEUTRAL}}catch(e){return null}throw TypeError("unknown action of dialogsx.getDialogAction")},linkify:function(e,r){if(e){let t=e.getContentView();ui.run(()=>{var e=t.getText().toString();t.setAutoLinkMask(Linkify[r||"ALL"]),t.setText(e)})}},setTitleText:function(e,t){ui.run(()=>{e&&e.getTitleView().setText(t?t.toString():"")})},alertContent:function(e,t,r){let n=e.getContentView();var o=n.getText().toString(),i="append"===r||!0===r,[s,a]=this._colors.content.alert.map(l.toInt);ui.post(()=>{n.setText((i?o+"\n\n":"")+t),n.setTextColor(s),n.setBackgroundColor(a)})},buildFlow:function(i){let s=this,a=Object.create(s.builds([i.title||"",i.steps.map((e,t)=>"　 "+ ++t+". "+e.desc).join("\n"),0,0,"I",1],{progress:{max:100,showMinMax:!!i.show_min_max}}));var e={act:function(){let e=new Promise(e=>{a.on("positive",()=>{global._$_dialog_flow_interrupted=!0}),"function"==typeof i.onStart&&i.onStart(i.initial_value,a),e(i.initial_value)});return i.steps.forEach((n,o)=>{e=e.then(t=>{if(global._$_dialog_flow_interrupted)throw Error(s._text.user_interrupted);var e=e=>(a.setProgress(100),c(o+1),n.onSuccess&&n.onSuccess(t),e);a.setProgress(0),function(){let n=(o+1).toString(),e=s.getContentText(a);s.setContentText(a,e.replace(/^(. )(\d)(?=\.)/gm,(e,t,r)=>(r===n?"▶ ":t)+r))}();let r=n.action(t,a);return r instanceof Promise?(r=r.then(e),r):e(r)},n.onFailure)}),e=e.then(e=>{if(global._$_dialog_flow_interrupted)throw Error(s._text.user_interrupted);s.setProgressColorTheme(a,"finish"),c("all"),a.removeAllListeners("positive"),a.setActionButton("positive",s._text._btn.F),a.on("positive",e=>e.dismiss());var t=i.success_title;t&&s.setTitleText(a,t);t=i.success_content;t&&s.appendContentText(a,"\n\n"+t),delete global._$_dialog_flow_interrupted,"function"==typeof i.onSuccess&&i.onSuccess(e,a)}),e.catch(e=>{s.setProgressColorTheme(a,"error"),a.removeAllListeners("positive");var t=s._text._btn[i.on_interrupt_btn_text||"B"];a.setActionButton("positive",t),a.on("positive",e=>e.dismiss()),s.alertContent(a,e,"append"),delete global._$_dialog_flow_interrupted,"function"==typeof i.onFailure&&i.onFailure(e,a)}),a.isShowing()||a.show(),l},setStepDesc:function(e,t,r){if(e<1)throw Error("step_num is less than 1");if(e>=i.steps.length)throw Error("step_num must be less than steps length");e=e.toString();let n=a.getContentView(),o=n.getText().toString();e=i.steps[e-1].desc;return o.match(e)&&(t=(r?e:"")+(t||""),n.setText(o.replace(e,t))),l},setProgressData:function(e){return"object"==typeof e&&(e=e.processed/e.total*100||0,a.setProgress(Math.min(Math.max(0,e),100))),l},setFailureData:function(e){return a.setActionButton("positive",s._text._btn.B),a.removeAllListeners("positive"),a.on("positive",e=>e.dismiss()),s.alertContent(a,e,"append"),l}};let l=Object.assign(a,e);return l;function c(e){var n="all"!==e&&e?e:1/0;let t=s.getContentText(a);s.setContentText(a,t.replace(/^(. )(\d)(?=\.)/gm,(e,t,r)=>(r<=n?"✔ ":t)+r))}},buildProgress:function(i){var r=this;let s=Object.create(r.builds([i.title||"",i.content||i.desc||"",0,0,"I",1],{progress:{max:100,showMinMax:!!i.show_min_max}}));var e={act:function(){return Promise.resolve(i.initial_value).then(e=>("function"==typeof i.onStart&&i.onStart(i.initial_value,s),e)).then(e=>{if(s.on("positive",()=>{global._$_dialog_flow_interrupted=!0}),global._$_dialog_flow_interrupted)throw Error(r._text.user_interrupted);return i.action(e,s)}).then(e=>{if(global._$_dialog_flow_interrupted)throw Error(r._text.user_interrupted);r.setProgressColorTheme(s,"finish"),s.setProgress(100),s.removeAllListeners("positive"),s.setActionButton("positive",r._text._btn.F),s.on("positive",e=>e.dismiss());var t=i.success_title;t&&r.setTitleText(s,t);t=i.success_content;t&&r.appendContentText(s,"\n\n"+t),delete global._$_dialog_flow_interrupted,"function"==typeof i.onSuccess&&i.onSuccess(e,s)}).catch(e=>{r.setProgressColorTheme(s,"error"),s.removeAllListeners("positive");var t=r._text._btn[i.on_interrupt_btn_text||"B"];s.setActionButton("positive",t),s.on("positive",e=>e.dismiss()),r.alertContent(s,e,"append"),delete global._$_dialog_flow_interrupted,"function"==typeof i.onFailure&&i.onFailure(e,s)}),s.isShowing()||s.show(),a},setStepDesc:function(e,t){let r=s.getContentView(),n=r.getText().toString();var o=i.content||"";return n.match(o)&&(e=(t?o:"")+(e||""),r.setText(n.replace(o,e))),a},setProgressData:function(e){return s.setProgress(e.processed/e.total*100),a},setFailureData:function(e){return s.setActionButton("positive",r._text._btn.B),s.on("positive",e=>e.dismiss()),r.alertContent(s,e,"append"),a}};let a=Object.assign(s,e);return a},setProgressColorTheme:function(e,t){let r=t;if(!Array.isArray(r))if("string"==typeof r)r=this._colors.progress[t]||[r];else{if("number"!=typeof r)throw Error("Unknown colors type for dialogsx.setProgressColorTheme()");r=[r]}var[n,o,t]=r;n&&this.setProgressTintList(e,n),o&&this.setProgressBackgroundTintList(e,o),t&&this.setActionButtonColor(e,"positive",t)},setActionButtonColor:function(e,t,r){t=this.getDialogAction(t.toLowerCase());null!==t&&(r=l.toInt(this._colors.wrap(r,"button")),e.getActionButton(t).setTextColor(r))},setProgressTintList:function(e,t){t=l.toInt(this._colors.wrap(t,"progress")),t=ColorStateList.valueOf(t);e.getProgressBar().setProgressTintList(t)},setProgressBackgroundTintList:function(e,t){t=l.toInt(t),t=ColorStateList.valueOf(t);e.getProgressBar().setProgressBackgroundTintList(t)},clearProgressNumberFormat:function(e){ui.run(()=>e.setProgressNumberFormat(""))},dismiss:function(e){(Array.isArray(e)?e:[].slice.call(arguments)).forEach(e=>{"object"==typeof e&&e.dismiss&&e.dismiss()})},disableBack:function(e,r){return e.setOnKeyListener({onKey:function(e,t){return"function"==typeof r&&r(),t===KeyEvent.KEYCODE_BACK}}),e},setContentText:function(e,t){ui.run(()=>{e&&e.getContentView().setText(t?t.toString():"")})},setProgressNumberFormat:function(e,t,r){ui.run(()=>e.setProgressNumberFormat(java.lang.String.format(t,r)))}},_={create:function(e){return new t(e)},remove:function(e){this.create(e).clear()}};function i(e){n.deployProject(e,{onSuccess:function(e,t){let n=e.target_path;e=h.getScriptDirPath();t.removeAllListeners("positive"),t.setActionButton("positive","下一步"),m.appendContentText(t,"\n\n项目部署路径:\n."+n.slice(e.length+n.search(e))),t.on("positive",e=>{function t(){m.builds(["项目使用声明",["代码完全公开","杜绝恶意代码","项目永久免费","欢迎提议反馈"].map(e=>"· "+e).join("\n"),0,0,["F","finish"],1,"立即运行项目"]).on("positive",e=>{if(e.dismiss(),e.isPromptCheckBoxChecked()){var t=context.getPackageName(),r=e=>{e=e||t;app.startActivity({packageName:t,className:e+".external.open.RunIntentActivity",data:"file://"+n+"/ant-forest-launcher.js"})};try{r("org.autojs.autojs")}catch(e){r(t)}}exit()}).show()}e.dismiss(),engines.myEngine().source.toString().match(/^Ant.Forest.+er/)?dialogs.build({title:"新项目使用提示",content:'可能需要在Auto.js程序主页下拉刷新才能看到新项目\n新项目默认是以"Ant-Forest-003"命名的蓝色目录 进入目录可运行新项目\n对于当前目录下的旧项目文件 若无保留需要 可全部移除\n移除时需谨慎 避免误删可能存在的项目以外的重要文件',positive:"下一步",autoDismiss:!1,canceledOnTouchOutside:!1}).on("positive",e=>{e.dismiss(),t()}).show():t()})}},{on_interrupt_btn_text:"X",success_title:"项目部署完成"})}function t(n){let o=files.getSdcardPath()+"/.local/",l=o+n+".nfe";files.createWithDirs(l);let i=()=>{let e=files.open(l,"r");var t=e.read();return e.close(),t};function c(e,t){if("number"!=typeof t||!isNaN(t)&&isFinite(t))return t;return"\ufeff"+t.toString()+"\ufeff"}function u(e,t){if("string"==typeof t){var r=/^\ufeff(.+)\ufeff$/;if(t.match(r))return+t.replace(r,"$1")}return t}function f(e){var t,r=i();try{return r?JSON.parse(r,e):{}}catch(e){console.warn("JSON.parse()解析配置文件异常")}try{return function(r,e){console.warn("尝试查找并修复异常的转义字符");let n=/[ntrfb\\'"0xu]/,o="";for(var i in r){var s=+i;let t=r[s];if("\\"===t){var a=r[s-1];let e=r[1+s];a&&e&&("\\"===a||e.match(n)||(t+="\\"))}o+=t}e=JSON.parse(o,e);console.info("修复成功");let t=files.open(l,"w");return t.write(o),console.info("已重新写入修复后的数据"),t.close(),e}(r,e)}catch(e){console.warn("转义字符修复失败")}try{return a(r,e)}catch(e){console.warn("乱码行修复失败")}throw t=n+".nfe."+Date.now()+".bak",files.rename(l,t),console.error("修复失败"),console.warn("已将损坏的配置文件备份至"),console.warn(o+t),console.warn("以供手动排查配置文件中的问题"),Error("JSON.parse() failed in ext-storages")}function a(e,r){console.warn("尝试查找并修复异常的乱码行");let n=e.split("\n"),o=n.length;for(;1<o--;)try{let e=n.slice(0,o-1);var i=n.slice(o+1),s=e.concat(i).join("\n"),i=JSON.parse(s,r);console.info("修复成功");let t=files.open(l,"w");return t.write(s),console.info("已重新写入修复后的数据"),t.close(),i}catch(e){}throw Error(a.name)}this.contains=function(e){return e in f()},this.get=function(e,t){var r=f(u);if(r&&e in r)return r[e];return t},this.put=function(e,t,r){if(void 0===t)throw new TypeError('"put" value can\'t be undefined');let n={},o={};try{n=f(u)}catch(e){console.warn(e.message)}var i="Object"===Object.prototype.toString.call(t).slice(8,-1),s="Object"===Object.prototype.toString.call(n[e]).slice(8,-1),s=i&&s;!r&&s&&Object.keys(t).length?o[e]=Object.assign(n[e],t):o[e]=t;let a=files.open(l,"w");a.write(JSON.stringify(Object.assign(n,o),c)),a.close()},this.remove=function(t){let r=f();if(t in r){let e=files.open(l,"w");e.write(JSON.stringify(r)),e.close(),delete r[t]}},this.clear=function(){files.remove(l)}}m.builds(["项目部署","欢迎使用蚂蚁森林项目部署工具\n此工具用于 v2.0.0 以上版本的项目部署",["了解项目","hint"],["退出","caution"],["开始部署","attraction"],1]).on("neutral",()=>{m.builds(["关于项目","- 功能简介 -\n"+["自动收取好友能量","自动收取/监测自己能量","收取结果统计/展示","控制台消息提示","自动解锁屏幕","定时任务与循环监测","多任务自动排队","脚本运行安全","事件监测与处理","黑名单机制","项目管理","账户功能","统计功能","图形化配置工具"].map(e=>"· "+e).join("\n")+"\n\n- 项目作者 -\n· SuperMonster003\n\n- 项目链接 -\n· https://github.com/SuperMonster003/Ant-Forest",0,0,"返回",1],{linkify:"WEB_URLS"}).on("positive",e=>e.dismiss()).show()}).on("negative",e=>{e.dismiss(),exit()}).on("positive",e=>{e.dismiss(),n.getProjectReleases({min_version_name:"v2.0.1",show_progress_dialog:!0},function(r){if(!r.length)return exit();var e=r[0];let t=e.version_name;m.builds(["选择项目版本","选择希望部署的项目版本",["版本历史","hint"],["X","warn"],"下一步",1],{items:["最新版本 ("+t+")","其他版本"],itemsSelectMode:"single",itemsSelectedIndex:0}).on("neutral",()=>{n.getProjectChangelog(t.match(/v(\d+)/)[1],{is_show_dialog:!0})}).on("negative",t=>{m.builds(["提示","项目部署尚未完成\n确定要退出吗",0,"B",["确定退出","caution"],1]).on("negative",e=>{e.dismiss()}).on("positive",e=>{e.dismiss(),t.dismiss(),exit()}).show()}).on("positive",t=>{t.dismiss(),0===t.getSelectedIndex()?y.start(function(){i(e)}):m.builds(["选择其他项目版本","",0,"上一步","下一步",1],{items:r.slice(1).map(e=>e.version_name),itemsSelectMode:"single",itemsSelectedIndex:0}).on("negative",e=>{e.dismiss(),t.show()}).on("positive",e=>{e.dismiss(),y.start(function(){i(r[e.getSelectedIndex()+1])})}).show()}).show()})}).show()}();