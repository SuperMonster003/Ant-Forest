<!--suppress HtmlDeprecatedAttribute -->

<div align="center">
  <p>
    <img alt="AF_Banner" src="https://github.com/SuperMonster002/Hello-Sockpuppet/raw/master/ant-forest-banner_374×106.png"/>
  </p>

  <p>基于 Auto.js 的蚂蚁森林能量自动收取脚本</p>
  <p>Auto.js-based ant forest energy auto-collect script</p>

  <p>
    <a href="https://github.com/SuperMonster003/Ant-Forest/releases/latest"><img alt="GitHub release (latest by date)" src="https://img.shields.io/github/v/release/SuperMonster003/Ant-Forest"/></a>
    <a href="https://github.com/SuperMonster003/Ant-Forest/issues"><img alt="GitHub closed issues" src="https://img.shields.io/github/issues/SuperMonster003/Ant-Forest?color=009688"/></a>
    <a href="https://github.com/hyb1996/Auto.js"><img alt="GitHub Auto.js repository" src="https://img.shields.io/badge/auto.js->= 4.1.1 alpha2-67a91b"/></a>
    <a href="https://github.com/topics/javascript"><img alt="GitHub top language" src="https://img.shields.io/github/languages/top/SuperMonster003/Ant-Forest?color=eb8031"/></a>
    <a href="https://www.codefactor.io/repository/github/SuperMonster003/Ant-Forest"><img alt="CodeFactor Grade" src="https://www.codefactor.io/repository/github/SuperMonster003/Ant-Forest/badge"/></a>
    <a href="https://lgtm.com/projects/g/SuperMonster003/Ant-Forest/?mode=list"><img alt="LGTM Grade" src="https://img.shields.io/lgtm/grade/javascript/github/SuperMonster003/Ant-Forest?label=lgtm"/></a>
    <br>
    <a href="https://github.com/SuperMonster003/Ant-Forest/commit/d43a0119b214a17062501ea8a938b13bd97d2028"><img alt="Created" src="https://img.shields.io/date/1552924800?color=2e7d32&label=created"/></a>
    <a href="https://github.com/SuperMonster003/Ant-Forest/find/master"><img alt="GitHub Code Size" src="https://img.shields.io/github/languages/code-size/SuperMonster003/Ant-Forest?color=795548"/></a>
    <a href="https://github.com/SuperMonster003/Ant-Forest/find/master"><img alt="GitHub Code Lines" src="https://img.shields.io/tokei/lines/github/SuperMonster003/Ant-Forest?color=37474F"/></a>
    <a href="https://github.com/SuperMonster003/Ant-Forest/blob/master/LICENSE"><img alt="GitHub License" src="https://img.shields.io/github/license/SuperMonster003/Ant-Forest?color=534BAE"/></a>
    <a href="https://www.jetbrains.com/?from=Ant-Forest"><img alt="JetBrains supporter" src="https://img.shields.io/badge/supporter-JetBrains-ee4677"/></a>
    <a href="https://github.com/SuperMonster003/Ant-Forest/blob/master/assets/docs/TODO.md"><img alt="Todo list" src="https://img.shields.io/badge/todo-55-C63F17"/></a>
  </p>
</div>

******

### 待办事项

******

| Status | Task | Date | Cost | Progress |
| :---: | --- | :---: | :---: | :---: |
| ✒️ | 推迟任务加入下次关屏选项 <!-- run-af-on-screen-off.js --> | 2021-10-26 11:18:43 | 5 | 0.30 <!-- est --> |
| ✒️ | 启动器模块化 | 2021-10-26 08:25:42 | 10 | 0.01 <!-- 1 -  6915 / 6998 --> |
| ✒️ | 配置工具模块化 | 2021-10-26 08:24:34 | 10 | 0.00 <!-- 1 - 8141 / 8138 --> |
| ✒️ | 扩展模块及插件重构 | 2021-10-26 14:37:07 | ! 8 | 0.33 <!-- 9 / 27 --> |
| ✒️ | 将 tool functions 转换为 OOP | 2021-10-25 22:24:13 | 10 | 0.11 <!-- 1 - 227 / 256 --> |
| ✒️ | 保护地巡护工具 | 2021-10-26 10:34:25 | 9 | 0.20 <!-- est --> |
| ✒️ | 提取 JSDoc@typedef 到 TS 声明文件 | 2021-10-25 22:25:18 | 10 | 0.94 <!-- 1 - 5 / 86 --> |

> 全部待办事项可参阅 [TODO.md](https://github.com/SuperMonster003/Ant-Forest/blob/master/assets/docs/TODO.md) (共计 55 项)

******

### 使用说明

******

1. 检查设备环境

- 操作系统: Android 7.0+

2. 下载并安装 Auto.js

- [4.1.1 Alpha2](https://github.com/SuperMonster002/Hello-Sockpuppet/raw/master/%5Bauto.js%5D%5B4.1.1_alpha2%5D%5Barm-v7%5D(b69a4e23).apk?raw=true) (`免费版本`)
- [Pro 7.0.4-1](https://github.com/SuperMonster002/Hello-Sockpuppet/blob/master/%5Bauto.js%5D%5Bpro_7.0.4-1%5D(31b16c93).apk?raw=true) (`付费版本`)
- [Pro 8.3.16-0](https://github.com/SuperMonster002/Hello-Sockpuppet/blob/master/%5Bauto.js%5D%5Bpro_8.3.16-0%5D(9a414abf).apk?raw=true) (`付费版本`)
- [Pro 8.8.20-0](https://github.com/SuperMonster002/Hello-Sockpuppet/blob/master/%5Bauto.js%5D%5Bpro_8.8.20-0%5D(b50062bf).apk?raw=true) (`付费版本`)

3. 下载并部署项目 (任意一种方式)

- [下载项目部署工具](https://raw.githubusercontent.com/SuperMonster003/Ant-Forest/master/tools/ant-forest-deployment-tool.min.js) (`*.js`)
    1. 将部署工具 (脚本文件) `保存` 或 `另存为` 至本地存储
    2. 用 `Auto.js` 直接运行 (或导入后运行) 脚本文件完成部署
    3. 部署后可能需要关闭并重启 `Auto.js` 才能看到项目目录
- [下载最新项目数据包](https://github.com/SuperMonster003/Ant-Forest/archive/master.zip) (`*.zip`)
    1. 将项目数据包解压到本地存储
    2. 定位到设备的内部存储目录 如:  
       `/内部存储/` `/Internal Storage/` `/sdcard/` `/storage/emulated/0/` 等
    3. 在此目录下找到 `Auto.js` 默认工作目录  
       · 中文系统默认目录 `./脚本/`  
       · 英文系统默认目录 `./Scripts/`
    4. 若不存在则需手动建立工作目录  
       或在 `Auto.js` 软件中设置工作目录
    5. 将解压后的项目文件夹放置在工作目录中

4. 使用 Auto.js 运行项目

- 运行 `ant-forest-launcher.js` 启动项目
- 运行 `ant-forest-settings.js` 配置项目
- 项目 `tools` 文件夹包含小工具 (详见[项目文档](https://github.com/SuperMonster003/Ant-Forest/blob/master/assets/assets/docs/MANNUAL.md#%E5%85%B6%E4%BB%96%E8%BE%85%E5%8A%A9%E5%B7%A5%E5%85%B7))

******

### 使用指南

******

* [快速手册](https://www.bilibili.com/video/av91979276/) (`视频`)
* [项目文档](https://github.com/SuperMonster003/Ant-Forest/wiki/%E8%9A%82%E8%9A%81%E6%A3%AE%E6%9E%97-(Ant-Forest)) (`文字`)

******

### 功能简介

******

* 自动收取好友能量
* 自动收取/监测自己能量
* 收取结果统计/展示

<details><summary>查看更多功能</summary><br>

* 控制台消息提示  
  · 开发者测试日志 (默认关闭)
* 自动解锁屏幕  
  · 提供解锁密码录入等配置
* 定时任务与循环监测  
  · 好友排行榜样本复查  
  · 主页能量球循环监测  
  · 定时任务自动管理
* 多任务自动排队
* 脚本运行安全  
  · 运行失败自动重试  
  · 单次运行最大时间限制  
  · 排他性任务最大排队时间限制  
  · 脚本炸弹预防
* 事件监测与处理  
  · 账户登出  
  · 屏幕意外关闭  
  · 来电响铃或通话
* 多语言支持 (简体中文/英语)  
  · 自动切换简体中文语言
* 黑名单机制  
  · 能量保护罩黑名单自动管理  
  · 用户自定义黑名单管理 (列表选择/检索选择)
* 项目管理  
  · 在线更新项目  
  · 本地备份项目  
  · 本地或服务器还原项目  
  · 项目更新提示/版本忽略
* 信息加密存储  
  · 自动生成密文字典文件  
  · 使用密文存储账户信息/解锁密码等敏感信息
* 账户功能  
  · 防止其他账户意外收取 (需录入主账户信息)  
  · 主账户操作完毕可自动回切之前登录的账户
* 统计功能
* 适应恶劣条件  
  · 脚本在网络条件较差时仍可正常运行或识别异常
* 图形化配置工具  
  · 基于UI的配置工具 可详细配置项目参数

</details>

******

### 版本历史

******

[comment]: <> (Version history only shows last 3 versions)

# v2.2.0

###### 2021/10/26 - 代码重构 API变更 项目结构变更 谨慎升级

* `修复` 账户功能开启时自动登录可能失败的问题 _[`issue #524`](https://github.com/SuperMonster003/Ant-Forest/issues/524)_
* `修复` 能量雨组件更新导致相关工具运行异常的问题 _[`issue #525`](https://github.com/SuperMonster003/Ant-Forest/issues/525)_
* `修复` 主页浇水能量球误识别导致假死的问题 _[`issue #518`](https://github.com/SuperMonster003/Ant-Forest/issues/518)_
* `修复` 对话框返回键监听器触发时连续执行两次的问题
* `修复` 获取能量罩信息时可能无法正确获取日期的问题
* `修复` 能量罩好友在同一会话中重复加入黑名单的问题
* `修复` 蚂蚁森林备用启动方案不支持新版支付宝的问题
* `修复` 进入好友森林后自动展开好友动态可能不成功的问题
* `修复` 配置工具开发者页面点击图标时可能报错退出的问题
* `修复` 运行提示对话框推迟任务时可能导致脚本假死的问题
* `修复` 音量键监听器线程可能被提前终止致使功能失效的问题
* `修复` 音量键停止脚本后部分图片资源可能未及时回收的问题
* `修复` 主页能量球监控到达成熟时间后可能未及时停止的问题 _[`issue #508`](https://github.com/SuperMonster003/Ant-Forest/issues/508)_ _[`#521`](https://github.com/SuperMonster003/Ant-Forest/issues/521)_
* `修复` IMAGES扩展模块多次加载导致截图权限申请失败的问题
* `修复` 排行榜截图样本池差异检测失效导致可能的停检迟缓问题 _[`issue #519`](https://github.com/SuperMonster003/Ant-Forest/issues/519)_ _[`#526`](https://github.com/SuperMonster003/Ant-Forest/issues/526)_
* `修复` 部分Pro版本无法获取DialogAction静态变量的问题 _[`issue #520`](https://github.com/SuperMonster003/Ant-Forest/issues/520)_
* `修复` $$sel.pickup()罗盘p标记跨标记定位时的定位错误问题
* `修复` 部分Pro版本无障碍服务未开启时运行配置工具无响应的问题
* `优化` 增加$$sel.pickup()箭头函数回调并优化错误提示
* `优化` 增加$$sel.pickup()罗盘k标记可向上遍历clickable控件
* `优化` 增加$$sel.traverse()/traverseAll()可遍历并筛选子控件
* `优化` 脚本结束前及时关闭数据库实例以释放部分资源 _[`issue #497`](https://github.com/SuperMonster003/Ant-Forest/issues/497#issuecomment-913081139)_
* `优化` 使用Webpack替代UglifyJS避免项目部署工具代码冗余
* `优化` 整合mod-monster-func所有方法到相关子扩展模块中
* `优化` waitForAction()增加回调可直接使用条件源的返回值
* `优化` 简化imagesx.getName()实现并摒弃不必要的备用方案
* `优化` 图标资源整合至本地文件提升读取效率并增加哈希校验
* `优化` 图标资源匹配优化分辨率自适应并提升无缓存匹配效率
* `优化` 图标资源可根据哈希信息实现缓存自销毁及缓存自更新
* `优化` 提升配置工具查看历史更新获取速度及成功率
* `优化` 提升能量雨条件识别及统计结果的效率及准确率
* `优化` 使用基于Pro版本的crypto模块替代pwmap模块提升可用性
* `提示` crypto模块可读取pwmap模块的数据文件但不支持反向读取

# v2.1.10

###### 2021/08/22

* `修复` 获取能量罩信息时可能出现空指针的问题
* `修复` 闹钟间隔事件监测代码异常导致脚本终止的问题
* `修复` $$cvt对0到1之间的输入数据返回值为空的问题
* `优化` threadsx.start()支持箭头函数及绑定函数
* `优化` Pro版本增加对话框按钮自定义颜色设置的支持
* `优化` Pro版本移除获取控件信息对currentPackage()的依赖

# v2.1.9

###### 2021/08/20

* `修复` 配置工具无法设置排行榜滑动距离等相关配置项的问题
* `修复` 获取能量球数据缓存时逻辑错误导致效率提升无效的问题
* `修复` OCR方案获取倒计时耗时过久未能按预期及时停止的问题
* `优化` 霍夫变换覆盖检测方法优化以提高成熟能量球识别率 _[`issue #508`](https://github.com/SuperMonster003/Ant-Forest/issues/508#issuecomment-900102913)_

##### 更多版本历史可参阅

* [CHANGELOG-2.md](https://github.com/SuperMonster003/Ant-Forest/blob/master/assets/docs/CHANGELOG-2.md)  ( 2.x 版本 )
* [CHANGELOG-1.md](https://github.com/SuperMonster003/Ant-Forest/blob/master/assets/docs/CHANGELOG-1.md)  ( 1.x 版本 )

[comment]: <> (If you prefer to make a donation, run ant-forest-settings.js with Auto.js, scroll down to bottom and click "关于脚本及开发者" button, which means "about script and developer", then click my GitHub user name. When a new page popped up, you could see the QR Code by long-clicking the pink "CLOSE" button. The blue for Alipay and the green for WeChat. I believe I could make it better with your support.)